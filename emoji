#!/usr/bin/env python3
# coding=utf-8

import os
import platform
import subprocess
import sys

ALIASES = {
    'fliptable': 'flip',
    'table': 'flip',
    'box': 'black_button',
    'check': 'check_button',
    'cross': 'cross_mark',
    'x': 'cross_mark',
}

ALL_EMOJI = {
    'unimpressed': 'à² _à² ',
    'shrug': r'Â¯\_(ãƒ„)_/Â¯',
    'flip': '(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”»',
    'tm': 'â„¢',

    'check_button': 'âœ…',
    'cross_button': 'âŽ',
    'black_button': 'ðŸ”²',
    'check_mark': 'âœ”ï¸',
    'cross_mark': 'âŒ',

    'cat': '(^._.^)ï¾‰',
    'catface': '(^äºº^)',
    'sideeye': '(Â¬_Â¬)',

    'o_O': 'ãƒŸâ—ï¹â˜‰ãƒŸ',
    'o_O2': '(âŠ™_â—Ž)',
    'o_O3': '(âŠ™ï¹âŠ™âœ¿)',

    'dance1': 'â”Œ(ãƒ»ã€‚ãƒ»)â”˜â™ª',
    'dance2': 'â””(ãƒ»ã€‚ãƒ»)â”â™ª',
    'dance3': 'â™ªâ”Œ(Ë˜âŒ£Ë˜)Êƒ',

    'scared': '(Â´ï½¥_ï½¥`)',

    'flowerhappy': '(âœ¿â— â€¿â— )',
    'hug': 'âŠ‚((ãƒ»â–½ãƒ»))âŠƒ',

    'facepalm': '(>_<)',
}


def has_clipboard_capability():
    host_os = platform.system()
    if host_os == 'Darwin':
        return True
    elif host_os == 'Linux':
        if os.path.exists('/usr/bin/xclip'):
            return True
        else:
            return False
    else:
        sys.stderr.write('warning: unknown OS %r\n' % host_os)
        return False


def clipboard_copy(text):
    host_os = platform.system()
    if host_os == 'Darwin':
        return clipboard_copy_mac(text)
    elif host_os == 'Linux':
        return clipboard_copy_linux(text)
    else:
        sys.stderr.write('warning: unknown OS %r\n' % host_os)
        return False


def clipboard_copy_mac(text):
    p = subprocess.Popen(['pbcopy'], stdin=subprocess.PIPE)
    return p.communicate(text.encode('utf-8'))


def clipboard_copy_linux(text):
    p = subprocess.Popen(['xclip', '-silent', '-selection', 'clipboard'],
                         stdin=subprocess.PIPE)
    return p.communicate(text.encode('utf-8'))


def emoji_for(word):
    word = ALIASES.get(word, word)
    return ALL_EMOJI[word]


def main(args):
    if len(args) >= 1:
        word = args[0]
        try:
            emoji = emoji_for(word)
        except KeyError:
            sys.stderr.write('Unknown emoji: %r\n' % word)
            return 1
        print(emoji)
        if USE_CLIPBOARD:
            clipboard_copy(emoji)
            sys.stderr.write('(copied to clipboard)\n')
    else:
        for name, emoji in ALL_EMOJI.items():
            print(name + ':', emoji)
    return 0


USE_CLIPBOARD = False
if 'CLIPBOARD' in os.environ:
    USE_CLIPBOARD = os.environ['CLIPBOARD']
else:
    if has_clipboard_capability():
        USE_CLIPBOARD = True


if __name__ == '__main__':
    sys.exit(main(sys.argv[1:]))
