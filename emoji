#!/usr/bin/env python
# coding=utf-8

import os
import subprocess
import sys

USE_CLIPBOARD = False
if 'CLIPBOARD' in os.environ:
    USE_CLIPBOARD = os.environ['CLIPBOARD']
else:
    if os.path.exists('/usr/bin/xclip'):
        USE_CLIPBOARD = True

ALIASES = {
    'fliptable': 'flip',
    'table': 'flip',
}

ALL_EMOJI = {
    'unimpressed': 'ಠ_ಠ',
    'shrug': '¯\_(ツ)_/¯',
    'flip': '(╯°□°)╯︵ ┻━┻',
    'tm': '™',

    'cat': '(^._.^)ﾉ',
    'catface': '(^人^)',
    'sideeye': '(¬_¬)',

    'o_O': 'ミ●﹏☉ミ',
    'o_O2': '(⊙_◎)',
    'o_O3': '(⊙﹏⊙✿)',

    'dance1': '┌(・。・)┘♪',
    'dance2': '└(・。・)┐♪',
    'dance3': '♪┌(˘⌣˘)ʃ',

    'scared': '(´･_･`)',

    'flowerhappy': '(✿◠‿◠)',
    'hug': '⊂((・▽・))⊃',

    'facepalm': '(>_<)',
}

def clipboard_copy(text):
    # TODO: add support for other OSes
    p = subprocess.Popen(['xclip', '-silent', '-selection', 'clipboard'],
                         stdin=subprocess.PIPE)
    p.communicate(text)

def emoji_for(word):
    word = ALIASES.get(word, word)
    return ALL_EMOJI[word]

def main(args):
    if len(args) >= 1:
        word = args[0]
        try:
            emoji = emoji_for(word)
        except KeyError:
            sys.stderr.write('Unknown emoji: %r\n' % word)
            return 1
        print emoji
        if USE_CLIPBOARD:
            clipboard_copy(emoji)
            sys.stderr.write('(copied to clipboard)\n')
    else:
        for name, emoji in ALL_EMOJI.iteritems():
            print name + ':', emoji
    return 0

if __name__ == '__main__':
    sys.exit(main(sys.argv[1:]))

